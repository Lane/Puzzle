<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
				
				<link href="css/tyrannosaurus.css" rel="stylesheet" />
				
				<script src="js/libs/modernizr-2.6.2.min.js"></script>
        <script src="http://code.createjs.com/createjs-2013.02.12.min.js" type="text/javascript"></script>
        <script src="http://code.createjs.com/preloadjs-0.3.0.min.js" type="text/javascript"></script>
        <script src="http://code.createjs.com/tweenjs-0.4.1.min.js" type="text/javascript"></script>
        <script src="js/vendor/easeljs/filters/ColorFilter.js"></script>
        <script src="js/libs/ba-debug.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
      
      	<div id="fullscreen" class="canvasHolder">
      		<canvas id="puzzleCanvas"></canvas>
      		<div id="interface">
      			<h1>Build a Tyrannosaurus</h1>
      			<div class="welcome-body">
	      			<img id="instructions" src="assets/trex/LowRes/instructions.gif" />
	      			<p>
	      				The following screen contains an interactive 2D puzzle.  The hips of the Tyrannosaurus are already in place, move and rotate the other pieces of the puzzle into place to rebuild the Tyrannosaurus. 
	      			</p>
	      			<ul id="controls">
	      				<li><strong>Select:</strong> Click on a piece</li>
	      				<li><strong>Deselect:</strong> Double Click away from a piece</li>
	      				<li><strong>Move:</strong> Click and drag on a piece</li>
	      				<li><strong>Rotate:</strong> Select a piece, then click and drag away from the piece</li>
	      			</ul>
      			</div>
      			
      			<div class="action-row">
      				<div id="loader"> 
      					<span id="loading-label"></span>
      					<div id="progress-bar"></div>
      				</div>
      				<a id="start" href="#" class="btn btn-start btn-disabled">Loading</a>
      			</div>
      		</div>
      		<div id="nav">
      			<a id="fstoggle" href="#" class="btn btn-hint">Fullscreen</a>
      			<a id="hint-toggle" href="#" class="btn btn-hint">Show Hint</a>
      		</div>
      		<p id="piece-label" class="inactive"></p>
      	</div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/libs/jquery-1.9.0.min.js"><\/script>')</script>
        <script src="js/utils.js"></script>
        <script src="js/Objects/Event.js"></script>
        <script src="js/Objects/Boundary.js"></script>
        <script src="js/Objects/PieceContainer.js"></script>
        <script src="js/Objects/Piece.js"></script>
        <script src="js/Objects/Point.js"></script>
        <script src="js/Model/Puzzle.js"></script>
        <script src="js/View/PuzzleView.js"></script>
        <script src="js/Controller/PuzzleController.js"></script>        
        <script src="js/PuzzleBuilder.js"></script>
        <script>       			
       			debug.setLevel(0);
       			//var debugPoints = true;
       			var todo = true;
       			
        		$(document).ready(function() {
      
        			var TrexPuzzle = {
        				background: { id : "background", src : "assets/tyrannosaurus/background.jpg" },
        				hint: { id : "hint", src: "assets/trex/LowRes/hint.png" },
        				sounds: [
        					{ id: "snap", mp3 : "assets/trex/sounds/snap3.mp3", ogg : "assets/trex/sounds/snap3.ogg" },
        					{ id: "success", mp3 : "assets/trex/sounds/Dinosaur_Growl.mp3", ogg : "assets/trex/sounds/Dinosaur_Growl.ogg" }
        				],
        				pieces: [
        					{ id: "cervical", 	name: "Cervical", src: "assets/trex/LowRes/N-Cervical.png", hover: "assets/trex/LowRes/H-Cervical.png", selected: "assets/trex/LowRes/S-Cervical.png", zindex: 11 },
        					{ id: "dorsal", 		name: "Dorsal", src: "assets/trex/LowRes/N-Dorsal.png", hover: "assets/trex/LowRes/H-Dorsal.png", selected: "assets/trex/LowRes/S-Dorsal.png", zindex: 5 },
        					{ id: "gastracia", 	name: "Gastracia", src: "assets/trex/LowRes/N-Gastracia.png", hover: "assets/trex/LowRes/H-Gastracia.png", selected: "assets/trex/LowRes/S-Gastracia.png", zindex: 4 },
        					{ id: "ischium", 		name: "Ischium", src: "assets/trex/LowRes/N-Ischium.png", hover: "assets/trex/LowRes/H-Ischium.png", selected: "assets/trex/LowRes/S-Ischium.png", zindex: 7 },
        					{ id: "left-arm", 	name: "Left Arm", src: "assets/trex/LowRes/N-LArm.png", hover: "assets/trex/LowRes/H-LArm.png", selected: "assets/trex/LowRes/S-LArm.png", zindex: 12  },
        					{ id: "left-leg", 	name: "Left Leg", src: "assets/trex/LowRes/N-LLeg.png", hover: "assets/trex/LowRes/H-LLeg.png", selected: "assets/trex/LowRes/S-LLeg.png", zindex: 10 },
        					{ id: "lower-jaw", 	name: "Lower Jaw", src: "assets/trex/LowRes/N-LowerJaw.png", hover: "assets/trex/LowRes/H-LowerJaw.png", selected: "assets/trex/LowRes/S-LowerJaw.png", zindex: 13 },
        					{ id: "pubis", 			name: "Pubis", src: "assets/trex/LowRes/N-Pubis.png", hover: "assets/trex/LowRes/H-Pubis.png", selected: "assets/trex/LowRes/S-Pubis.png", zindex: 8 },
        					{ id: "right-arm", 	name: "Right Arm", src: "assets/trex/LowRes/N-RArm.png", hover: "assets/trex/LowRes/H-RArm.png", selected: "assets/trex/LowRes/S-RArm.png", zindex: 1 },
        					{ id: "ribs", 			name: "Ribs", src: "assets/trex/LowRes/N-Ribs.png", hover: "assets/trex/LowRes/H-Ribs.png", selected: "assets/trex/LowRes/S-Ribs.png", zindex: 6 },
        					{ id: "right-leg", 	name: "Right Leg", src: "assets/trex/LowRes/N-Rleg.png", hover: "assets/trex/LowRes/H-Rleg.png", selected: "assets/trex/LowRes/S-Rleg.png", zindex: 2  },
        					{ id: "sacral-and-illium", name: "Sacral and Illium", src: "assets/trex/LowRes/N-SacralAndIllium.png", hover: "assets/trex/LowRes/H-SacralAndIllium.png", selected: "assets/trex/LowRes/S-SacralAndIllium.png", fixed: true, x:416, y:118, zindex: 9 },
        					{ id: "skull", 			name: "Skull", src: "assets/trex/LowRes/N-Skull.png", hover: "assets/trex/LowRes/H-Skull.png", selected: "assets/trex/LowRes/S-Skull.png", zindex:14  },
        					{ id: "tail", 			name: "Tail", src: "assets/trex/LowRes/N-Tail.png", hover: "assets/trex/LowRes/H-Tail.png", selected: "assets/trex/LowRes/S-Tail.png", zindex: 3 }
        				],
        				matches: [
        					[ 
        						{ piece: "skull", x: 44, y:1 }, 	
        						{ piece: "lower-jaw", x: 20 , y: -35 } 
        					],
        					[ 
        						{ piece: "skull", 		x: 45, 	y: -25 }, 	
        						{ piece: "cervical", 	x: -36, 	y: -17 } 
        					],
									[ 
										{ piece: "cervical", x: 29, 	y: 18 }, 	
										{ piece: "ribs", 	x: -70, 	y: -22} 
									],
									[ 
										{ piece: "cervical", x: 26, 	y: -2 }, 	
										{ piece: "dorsal", 	x: -79, 	y: -4 } 
									],
									[ 
										{ piece: "dorsal", x: -14, 	y: -5 }, 	
										{ piece: "ribs", 	x: -8, 	y: -43 } 
									],
									[ 
										{ piece: "dorsal", x: -27,  y: -2 }, 	
										{ piece: "left-arm", 	x: 23, 	y: -56 } 
									],
									[ 
										{ piece: "dorsal", x: -27, 	y: -3 }, 	
										{ piece: "right-arm", 	x: 31, 	y: -45 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: -48, 	y: -3}, 	
										{ piece: "dorsal", 	x: 66, 	y: 6 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: -7, 	y: 17 }, 	
										{ piece: "left-leg", 	x: -61, 	y: -106 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: -8, 	y: 18 }, 	
										{ piece: "right-leg", 	x: 19, 	y: -88 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: -23 , 	y: 22}, 	
										{ piece: "pubis", 	x: 14, 	y: -45 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: 8 , 	y: 26 }, 	
										{ piece: "ischium", 	x: -20 , 	y: -28 } 
									],
									[ 
										{ piece: "pubis", x: -22, 	y: 32 }, 	
										{ piece: "gastracia", x: 63, 	y: 18 } 
									],
									[ 
										{ piece: "sacral-and-illium", x: 53, 	y: 13 }, 	
										{ piece: "tail", 	x: -174, 	y: -2} 
									]
        				]
        			};
        			
        			var highResPieces = [
        				{ id: "cervical", 	name: "Cervical", src: "assets/trex/HighRes/N-Cervical.png", hover: "assets/trex/HighRes/H-Cervical.png", selected: "assets/trex/HighRes/S-Cervical.png", zindex: 11, scale:0.5 },
        				{ id: "dorsal", 		name: "Dorsal", src: "assets/trex/HighRes/N-Dorsal.png", hover: "assets/trex/HighRes/H-Dorsal.png", selected: "assets/trex/HighRes/S-Dorsal.png", zindex: 5, scale:0.5 },
        				{ id: "gastracia", 	name: "Gastracia", src: "assets/trex/HighRes/N-Gastracia.png", hover: "assets/trex/HighRes/H-Gastracia.png", selected: "assets/trex/HighRes/S-Gastracia.png", zindex: 4, scale:0.5 },
        				{ id: "ischium", 		name: "Ischium", src: "assets/trex/HighRes/N-Ischium.png", hover: "assets/trex/HighRes/H-Ischium.png", selected: "assets/trex/HighRes/S-Ischium.png", zindex: 7, scale:0.5 },
        				{ id: "left-arm", 	name: "Left Arm", src: "assets/trex/HighRes/N-LArm.png", hover: "assets/trex/HighRes/H-LArm.png", selected: "assets/trex/HighRes/S-LArm.png", zindex: 12, scale:0.5  },
        				{ id: "left-leg", 	name: "Left Leg", src: "assets/trex/HighRes/N-LLeg.png", hover: "assets/trex/HighRes/H-LLeg.png", selected: "assets/trex/HighRes/S-LLeg.png", zindex: 10, scale:0.5},
        				{ id: "lower-jaw", 	name: "Lower Jaw", src: "assets/trex/HighRes/N-lowerjaw.png", hover: "assets/trex/HighRes/H-lowerjaw.png", selected: "assets/trex/HighRes/S-lowerjaw.png", zindex: 13, scale:0.5 },
        				{ id: "pubis", 			name: "Pubis", src: "assets/trex/HighRes/N-Pubis.png", hover: "assets/trex/HighRes/H-Pubis.png", selected: "assets/trex/HighRes/S-Pubis.png", zindex: 8, scale:0.5 },
        				{ id: "right-arm", 	name: "Right Arm", src: "assets/trex/HighRes/N-RArm.png", hover: "assets/trex/HighRes/H-RArm.png", selected: "assets/trex/HighRes/S-RArm.png", zindex: 1, scale:0.5 },
        				{ id: "ribs", 			name: "Ribs", src: "assets/trex/HighRes/N-Ribs.png", hover: "assets/trex/HighRes/H-Ribs.png", selected: "assets/trex/HighRes/S-Ribs.png", zindex: 6, scale:0.5 },
        				{ id: "right-leg", 	name: "Right Leg", src: "assets/trex/HighRes/N-RightLeg.png", hover: "assets/trex/HighRes/H-RightLeg.png", selected: "assets/trex/HighRes/S-RightLeg.png", zindex: 2, scale:0.5  },
        				{ id: "sacral-and-illium", name: "Sacral and Illium", src: "assets/trex/HighRes/N-SacralAndIllium.png", hover: "assets/trex/HighRes/H-SacralAndIllium.png", scale:0.5, selected: "assets/trex/HighRes/S-SacralAndIllium.png", fixed: true, x:416, y:118, zindex: 9 },
        				{ id: "skull", 			name: "Skull", src: "assets/trex/HighRes/N-skull.png", hover: "assets/trex/HighRes/H-skull.png", selected: "assets/trex/HighRes/S-skull.png", zindex:14, scale:0.5  },
        				{ id: "tail", 			name: "Tail", src: "assets/trex/HighRes/N-Tail.png", hover: "assets/trex/HighRes/H-Tail.png", selected: "assets/trex/HighRes/S-Tail.png", zindex: 3, scale:0.5 }
        			];
        			
        			// if high res
        			// TrexPuzzle.pieces = highResPieces; 
        			
        			var loader = new PuzzleBuilder();
        			
        			var welcomeScreen = document.getElementById("interface");
        			var loadingLabel = document.getElementById("loading-label");
        			var progressBar = document.getElementById("progress-bar");
        			var startButton = document.getElementById("start");
        			var holder = document.getElementById("fullscreen");
        			var pieceLabel = document.getElementById("piece-label");
        			var fstoggle = document.getElementById("fstoggle");
        			var hintToggle = document.getElementById("hint-toggle");
        			
        			
        			loader.loadPuzzle(TrexPuzzle);
        			
        			window.puzzle = loader.puzzle;
        			
        			loader.progressChange.attach(function(sender,args) {
        				var e = args.event;
        				var amountLoaded = Math.round(e.loaded*100);
        				progressBar.style.width = amountLoaded+"%";
        				progressBar.style.opacity = e.loaded;
        			});
        			
        			loader.fileLoaded.attach(function(sender, args) {
        				console.log(args.event.item);
        				if(typeof(args.event.item.id) !== "undefined")
        					loadingLabel.innerText = "Loaded " + args.event.item.type + ": " + args.event.item.id;
        			});
        			
        			loader.puzzleLoaded.attach(function(sender,args) {
        				startButton.innerText = "Get Started";
        				startButton.className = "btn btn-start btn-enabled";
        				loadingLabel.innerText = "Loading complete";
        			});
        			
        			loader.getPuzzle().selectedPieceChanged.attach(function(sender,args) {
        				if(typeof(args.newPiece) == "undefined" || args.newPiece == null) {
        					pieceLabel.className = "inactive";
        				} else {
        					pieceLabel.innerText = args.newPiece.getPieceString();
        					pieceLabel.className = "active";
        				}
        			});
        			
        			loader.getPuzzle().puzzleComplete.attach(function(sender,args) {
        				hintToggle.style.opacity = 0;
        				window.parent.$(window.parent.document).trigger('complete', [false]);
        			});
        			
        			startButton.onclick = function(event) {
        				holder.className = "canvasHolder started";
        				loader.handlePuzzleLoad();
        				//holder.style.width = window.innerWidth+'px';
        				//loader.getPuzzleView().resizePuzzle(878, 494);
        				if(!fullScreenApi.supportsFullScreen || true) { // get rid of true for detection
        					fstoggle.style.display = "none";
        				}
        				
        				// connect the initial pieces
        				puzzle.connectPointWithMatch(puzzle.getPieceByName("ischium").getPoints()[0]);
        				var pubisPoints = puzzle.getPieceByName("pubis").getPoints();
        				for(var i = 0; i < pubisPoints.length; i++) {
        					if(pubisPoints[i].getMatch().getPiece().name == "sacral-and-illium")
        					{
        						puzzle.connectPointWithMatch(pubisPoints[i]);
        					}
        				}
        				hintToggle.onclick = function() {
        					loader.puzzleView.showHint();
        				}
        			};
        			
        			
        			/*
      				window.onresize = function(event) {
      					holder.style.width = window.innerWidth+'px';
      					loader.getPuzzleView().resizePuzzle(window.innerWidth, window.innerHeight);
      				}
      				*/
        			
        			fstoggle.onclick = function() {
	        			if (RunPrefixMethod(document, "FullScreen") || RunPrefixMethod(document, "IsFullScreen")) {
	        				RunPrefixMethod(document, "CancelFullScreen");
	        			}
	        			else {
	        				RunPrefixMethod(holder, "RequestFullScreen");
	        			}
							}
        		});
        		
      		
        </script>
    </body>
</html>
